<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="concept _Skins_Side_Nav_2023_feb" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../" data-mc-has-content-body="True" data-mc-toc-path="Adding business logic |Formulas" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="Expires" content="0" />
        <meta http-equiv="Pragma" content="no-cache" />
        <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="msapplication-config" content="../Skins/Favicons/browserconfig.xml" />
        <link rel="apple-touch-icon" sizes="180x180" href="../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../Skins/Favicons/favicon-16x16.png" /><title>Typical mistakes in formulas</title>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <link href="../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/Components/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Fluid/Stylesheets/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Resources/Stylesheets/ib_platform.css" rel="stylesheet" type="text/css" />
        <link href="../Resources/TableStyles/ib-table.css" rel="stylesheet" data-mc-stylesheet-type="table" />
        <link rel="apple-touch-icon" sizes="180x180" href="../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../Skins/Favicons/favicon-16x16.png" />
        <script src="../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../Resources/Scripts/require.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
        <script src="../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript" defer="defer">
        </script>
        <script src="../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
        <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-164223934-1">
        </script>
        <script>/* <![CDATA[ */
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());

			gtag('config', 'UA-164223934-1');
	/* ]]> */</script>
        <script src="../Resources/Scripts/dynamic-search.js">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-left" role="navigation" id="offCanvas" data-off-canvas="" data-position="left" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-left is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div>
                        <nav class="title-bar tab-bar" role="banner" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-account-wrapper">
                                        <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                            <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                                <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../Welcome.htm" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" role="navigation" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="4" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="central-account-wrapper">
                                    <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div data-mc-content-body="True">
                                    <div style=" text-align: right; color:white; font-size: 9pt; background:#001649 ; margin-bottom: 15px; padding: 4px 12px; ">Documentation Version 
			<select id="versionSelect"><option value="v6.7.1">6.7.1</option><option value="v6.7.0">6.7.0</option><option value="v6.6.1">6.6.1</option><option value="v6.6">6.6</option></select><script>/* <![CDATA[ */
				const select = document.querySelector('#versionSelect');
				select.addEventListener('change', function() {
				const selectedVersion = this.value;
				const currentUrl = window.location.href;
				const newUrl = currentUrl.replace(/\/v\d+(\.\d+(\.\d+)?)?\//, `/${selectedVersion}/`);
				window.location.href = newUrl;
				});
		/* ]]> */</script></div>
                                    <div class="nocontent">
                                        <div class="MCBreadcrumbsBox_0 breadcrumbs" role="navigation" aria-label="Breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                                        </div>
                                    </div>
                                    <div class="home-container">
                                        <div class="topic-body" role="main" id="mc-main-content">
                                            <h1 class="concepttitle">Typical mistakes in formulas</h1>
                                            <p>The following sections summarize some typical mistakes and inefficiencies in formulas. </p>
                                            <div class="section">
                                                <h2 class="sectiontitle">Include tokens in quotes</h2>
                                                <p>Do not forget that template tokens like {!name} are not JavaScript variables.
    They are replaced by actual values before being sent to the JavaScript engine. While numeric
    values can be used as is, strings are typically enclosed in quotes to form a meaningful result. </p>
                                                <table class="TableStyle-ibplatform01 TableStyle-ib-table" style="mc-table-style: url('../Resources/TableStyles/ib-table.css');" cellspacing="0">
                                                    <thead>
                                                        <tr class="TableStyle-ib-table-Head-Header1">
                                                            <th class="TableStyle-ib-table-HeadE-Column1-Header1">Original Formula</th>
                                                            <th class="TableStyle-ib-table-HeadE-Column1-Header1">Parsed Results</th>
                                                            <th class="TableStyle-ib-table-HeadD-Column1-Header1">Comments</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr class="TableStyle-ib-table-Body-Body1">
                                                            <td class="TableStyle-ib-table-BodyE-Column1-Body1"><code>counter += {!amount};	counter += 100;</code>
                                                            </td>
                                                            <td class="TableStyle-ib-table-BodyE-Column1-Body1">Correct</td>
                                                            <td class="TableStyle-ib-table-BodyD-Column1-Body1">You can treat numerical tokens as variables.</td>
                                                        </tr>
                                                        <tr class="TableStyle-ib-table-Body-Body1">
                                                            <td class="TableStyle-ib-table-BodyE-Column1-Body1"><code>if ({!country#code} == "US")	If (CA == "US")</code>
                                                            </td>
                                                            <td class="TableStyle-ib-table-BodyE-Column1-Body1">JavaScript error</td>
                                                            <td class="TableStyle-ib-table-BodyD-Column1-Body1">CA variable does not exist.</td>
                                                        </tr>
                                                        <tr class="TableStyle-ib-table-Body-Body1">
                                                            <td class="TableStyle-ib-table-BodyB-Column1-Body1"><code> if ("{!country#code}" == "US")	If ("CA" == "US")</code>
                                                            </td>
                                                            <td class="TableStyle-ib-table-BodyB-Column1-Body1">Correct</td>
                                                            <td class="TableStyle-ib-table-BodyA-Column1-Body1">You must always enclose string tokens in quotes or make them a part of larger string.</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            <div class="section">
                                                <h2 class="sectiontitle">Unnecessary quotes</h2>
                                                <p>You can often use the fact that template tokens will be replaced with real,
    non-quoted values to your advantage by simplifying token concatenation. You don't have to use
    JavaScript to concatenate tokens - the template parser can do it for you.</p>
                                                <table class="TableStyle-ibplatform01 TableStyle-ib-table" style="mc-table-style: url('../Resources/TableStyles/ib-table.css');" cellspacing="0">
                                                    <thead>
                                                        <tr class="TableStyle-ib-table-Head-Header1">
                                                            <th class="TableStyle-ib-table-HeadE-Column1-Header1">Formula</th>
                                                            <th class="TableStyle-ib-table-HeadD-Column1-Header1">Comments</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr class="TableStyle-ib-table-Body-Body1">
                                                            <td class="TableStyle-ib-table-BodyE-Column1-Body1"><pre>var ln = "{!lastName}";
      var fn = "{!firstName}";
      return ln+", "+fn;	var ln = "Ellison";
      var fn = "John";
      return ln+", "+fn;</pre>
                                                            </td>
                                                            <td class="TableStyle-ib-table-BodyD-Column1-Body1">Correct but inefficient</td>
                                                        </tr>
                                                        <tr class="TableStyle-ib-table-Body-Body1">
                                                            <td class="TableStyle-ib-table-BodyB-Column1-Body1"><pre>return "{!lastName}, {!firstName}";	return "Ellison, John";</pre>
                                                            </td>
                                                            <td class="TableStyle-ib-table-BodyA-Column1-Body1">Correct and efficient</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            <div class="section">
                                                <h2 class="sectiontitle">Avoid loops in formulas</h2>
                                                <p>Although you can use template loops in formulas, be aware that they can result
    in very long JavaScript after parsing; that script could be aborted by Platform due to formula
    length and execution time limitations. Consider this example: </p><pre>{!#LOOP_BEGIN.R12345}
   // Do some processing
   rbv_api.setFieldValue(...);
   {!#LOOP_END.R12345}</pre>
                                                <p>The code inside the loop will be replicated for each record in the loop. A much more efficient
    approach would be to use a JavaScript for() loop: </p><pre>var ids = rbv_api.getRelatedIds("R123456", {!id});
   for (var i=0; i&lt;ids.length; i++) {
   var ordered = ids[i];
   rbv_api.runTrigger("order", orderId, "trUpdate");
   }</pre>
                                                <p>In this example, the formula obtains a list of related IDs, loops through them
    all and invokes a trigger on the corresponding related record. You may also use Query API to
    extract data instead of loops through data records. Warning: If a number record in a loop is
    large you may hit timeout limit for formula execution. </p>
                                            </div>
                                            <div class="section">
                                                <h2 class="sectiontitle">Using Comments</h2>
                                                <p>You can use valid JavaScript comments in your formulas. However please keep in mind that:</p>
                                                <ul>
                                                    <li>Comments enlarge total length of formula and may potentially lead to hitting limit on overall formula length.</li>
                                                    <li>Avoid using <code>//</code>-style comments since they may lead to error
     should carriage-return in your formula accidentally be lost. Use the  <code>/* */</code>
     style for comments in JavaScript formulas. </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="panel">
                                        <div class="right-align"><a class="footer1" href="https://www.linkedin.com/company/infiniteblue/" target="_blank"><img src="https://img.icons8.com/ios-filled/25/0572ed/linkedin-2--v1.png" alt="Linkedin" /></a><a class="footer1" href="https://twitter.com/InfiniteBlueHQ" target="_blank"><img src="https://img.icons8.com/ios-filled/25/0572ed/twitter.png" alt="Twitter" /></a><a class="footer1last" href="https://www.youtube.com/channel/UCRa_FE0f3k9KJrNJyAT39Hg/featured" target="_blank"><img src="https://img.icons8.com/ios-glyphs/25/0572ed/youtube-play.png" alt="YouTube" /></a>
                                        </div>
                                        <div class="right-align-2"><a class="footer2" href="https://www.infiniteblue.com" target="_blank">Copyright Â© 2023 Infinite Blue. All Rights Reserved.</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>