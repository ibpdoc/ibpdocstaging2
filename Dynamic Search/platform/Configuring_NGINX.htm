<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="task _Skins_Side_Nav_2023_feb" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../" data-mc-has-content-body="True" data-mc-toc-path="Advanced setup and administration|Installing and administering Private Cloud|Multi-server environments" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="Expires" content="0" />
        <meta http-equiv="Pragma" content="no-cache" />
        <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="msapplication-config" content="../Skins/Favicons/browserconfig.xml" />
        <link rel="apple-touch-icon" sizes="180x180" href="../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../Skins/Favicons/favicon-16x16.png" /><title>Configuring NGINX</title>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <link href="../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Default/Stylesheets/Components/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Skins/Fluid/Stylesheets/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Resources/Stylesheets/ib_platform.css" rel="stylesheet" type="text/css" />
        <link href="../Resources/TableStyles/ib-table.css" rel="stylesheet" data-mc-stylesheet-type="table" />
        <link rel="apple-touch-icon" sizes="180x180" href="../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../Skins/Favicons/favicon-16x16.png" />
        <script src="../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../Resources/Scripts/require.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
        <script src="../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript" defer="defer">
        </script>
        <script src="../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
        <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-164223934-1">
        </script>
        <script>/* <![CDATA[ */
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());

			gtag('config', 'UA-164223934-1');
	/* ]]> */</script>
        <script src="../Resources/Scripts/dynamic-search.js">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-left" role="navigation" id="offCanvas" data-off-canvas="" data-position="left" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-left is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div>
                        <nav class="title-bar tab-bar" role="banner" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-account-wrapper">
                                        <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                            <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                                <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../Welcome.htm" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" role="navigation" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="4" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="central-account-wrapper">
                                    <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div data-mc-content-body="True">
                                    <div style=" text-align: right; color:white; font-size: 9pt; background:#001649 ; margin-bottom: 15px; padding: 4px 12px; ">Documentation Version 
			<select id="versionSelect"><option value="v6.7.1">6.7.1</option><option value="v6.7.0">6.7.0</option><option value="v6.6.1">6.6.1</option><option value="v6.6">6.6</option></select><script>/* <![CDATA[ */
				const select = document.querySelector('#versionSelect');
				select.addEventListener('change', function() {
				const selectedVersion = this.value;
				const currentUrl = window.location.href;
				const newUrl = currentUrl.replace(/\/v\d+(\.\d+(\.\d+)?)?\//, `/${selectedVersion}/`);
				window.location.href = newUrl;
				});
		/* ]]> */</script></div>
                                    <div class="nocontent">
                                        <div class="MCBreadcrumbsBox_0 breadcrumbs" role="navigation" aria-label="Breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                                        </div>
                                    </div>
                                    <div class="home-container">
                                        <div class="topic-body" role="main" id="mc-main-content">
                                            <h1 class="tasktitle">Configuring NGINX</h1>
                                            <p class="shortdesc">This topic describes the procedure to configure nginx.</p>
                                            <div class="prereq"><a href="Installing_NGINX.htm">Install Nginx</a> on the target machine. </div>
                                            <p>Configuration of Nginx is controlled by a configuration file,
				<code>nginx.conf</code>located in
				<code>&lt;nginx_install_dir&gt;/conf</code> directory. The <code>nginx.conf</code> file also
			includes the <code>rb-upstreams.conf</code> ,
				<code>rb-locations.conf</code> and <code>proxy.conf</code> files
			which get stitched together.The <code> rb-upstreams.conf</code> &amp;
				<code>rb-locations.conf </code> contents are dynamically updated based on
			your topology when it is configured from Platform. So, there is no necessity to manually
			change these files .<p><table class="TableStyle-ib-table" style="width: 609px;mc-table-style: url('../Resources/TableStyles/ib-table.css');" cellspacing="0"><col style="width: 172px;" class="TableStyle-ib-table-Column-Column1" /><col style="width: 618px;" class="TableStyle-ib-table-Column-Column1" /><thead><tr class="TableStyle-ib-table-Head-Header1"><th class="TableStyle-ib-table-HeadE-Column1-Header1">File Name</th><th class="TableStyle-ib-table-HeadD-Column1-Header1">Description</th></tr></thead><tbody><tr class="TableStyle-ib-table-Body-Body1"><td class="TableStyle-ib-table-BodyE-Column1-Body1"><code>rb-upstreams.conf file</code></td><td class="TableStyle-ib-table-BodyD-Column1-Body1">This file contains the configuration related to upstream servers.
							This defines a named pool of servers that Nginx can then proxy requests
							to. For example,
							<pre>upstream webapi {
server localhost:80;
}
upstream storage {
server localhost:80;
}
upstream search {
server localhost:80;
}
upstream router {
server localhost:80;
}
upstream rest {
server localhost:80;
}
upstream prod1 {
server localhost:80;
}
upstream master {
server localhost:80;
}</pre></td></tr><tr class="TableStyle-ib-table-Body-Body1"><td class="TableStyle-ib-table-BodyE-Column1-Body1"><span class="filepath">rb-locations.conf</span></td><td class="TableStyle-ib-table-BodyD-Column1-Body1">This file contains the mapping between client requests and
							upstreams. For example,
							<pre>location /webapi {
proxy_pass http://webapi;
}
location /storage {
proxy_pass http://storage;
}
location /search {
proxy_pass http://search;
}
location /router {
proxy_pass http://router;
}
location /rest {
proxy_pass http://rest;
}
location ~ /prod1/(.+\.(png|gif|ico|jpg|jpe?g|svg|css|js|map|woff|woff2))$ {
alias static/$1;
}
location /prod1 {
proxy_pass http://prod1;
}
location ~ /master/(.+\.(png|gif|ico|jpg|jpe?g|svg|css|js|map|woff|woff2))$ {
alias static/$1;
}
location /master {
proxy_pass http://master;
}
location /*.jsp {
proxy_pass http://master;
}</pre></td></tr><tr class="TableStyle-ib-table-Body-Body1"><td class="TableStyle-ib-table-BodyB-Column1-Body1"><span class="filepath">proxy.conf</span></td><td class="TableStyle-ib-table-BodyA-Column1-Body1">This file contains proxy related configurations like setting proxy
							headers, etc. If https upstream is enabled, add respective proxy_ssl
							related configuration into this file. For example,
							<pre>proxy_redirect     off;
proxy_set_header   Host              $host;
proxy_set_header   X-Real-IP         $remote_addr;
proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;
proxy_set_header   X-Forwarded-Proto $scheme; 
proxy_set_header   X-Forwarded-Host  $host:$server_port;
proxy_connect_timeout      90;
proxy_send_timeout         90;
proxy_read_timeout         90;
proxy_buffer_size          4k;
proxy_buffers              4 32k;
proxy_busy_buffers_size    64k;
proxy_temp_file_write_size 64k; </pre></td></tr></tbody></table></p><div class="sectiondiv"><b>Serving Static Files from the Nginx machine</b><p>Once you configure
					the Nginx proxy in Platform, static files such as js, css &amp; images will be
					served from the Nginx machine. Nginx is bundled with all css, js &amp; images
					files of the current Platform version and is available for user to download. So,
					beginning with Platform 5.0 onwards, whenever a new version of Platform is
					available, it is recommended that you update the Nginx also to the latest
					version if you are using an Nginx machine. You can download the Nginx machine to
					respective platform and run it. When configuring the Webproxy (Nginx) from
					Platform, the <span class="filepath">rb-locations.conf</span> file required configuration
					is updated dynamically to serve static files from the Nginx machine instead (and
					not form the Tomcat). Nginx serves only the master and prod machine static
					files. </p><p>Sample <span class="filepath">rb-location.conf</span> file below to serve
					static files for prod/master machines request from
					Nginx.<pre>location ~ /prod1/(.+\.(png|gif|ico|jpg|jpe?g|svg|css|js|map|woff|woff2))$ {
alias static/$1;
}

location ~ /master/(.+\.(png|gif|ico|jpg|jpe?g|svg|css|js|map|woff|woff2))$ {
alias static/$1;
}
</pre>
					All static files available under static folder of Nginx folder such as
						<span class="filepath">\nginx\static\</span></p><div class="sectiondiv"><b>Nginx Java Handler</b><p>Nginx runs
						on two ports - one port is used for external access and the other port is a
						java handler on which Platform makes API calls for internal communication.
						The internal APIs are authenticated against a private key which exists in
						both Platform and the Nginx machine. The private key should be available at
							<span class="filepath">rollbase/config/security</span>
							directory.<div class="note"><b>Note: </b>You must copy the private.key from <span class="filepath">rollbase/config/security</span> and paste it
							into <span class="filepath">nginx/conf</span>
						folder.</div><pre xml:space="preserve">server {
            listen 9080;
            server_name localhost;
            handlers_lazy_init on;
							
            location / {
                        root   html;
                        index  index.html index.htm;
            }

            location /config/topology {
                        content_handler_type 'java';
                        content_handler_name 'com.rb.nginx.handler.ConfigHandler';
                        # Set this flag to true for proxy SSL
                        content_handler_property is.secure.server 'false';
                        # Authentication handler
                        access_handler_type 'java';
                        access_handler_name 'com.rb.nginx.handler.AuthenticationHandler';
            }

            location /config/environment {
                        content_handler_type 'java';
                        content_handler_name 'com.rb.nginx.handler.ConfigHandler';
                        # Authentication handler
                        access_handler_type 'java';
                        access_handler_name 'com.rb.nginx.handler.AuthenticationHandler';
            }
            
            location /config/files {
                        content_handler_type 'java';
                        content_handler_name 'com.rb.nginx.handler.ConfigHandler';
                        # Authentication handler
                        access_handler_type 'java';
                        access_handler_name 'com.rb.nginx.handler.AuthenticationHandler';
            }

        location /config/systemcheck {
                content_handler_type 'java';
                content_handler_name 'com.rb.nginx.handler.ConfigHandler';
                # Authentication handler
                access_handler_type 'java';
                access_handler_name 'com.rb.nginx.handler.AuthenticationHandler';
        }

        location /health/ping {
                content_handler_type 'java';
                content_handler_name 'com.rb.nginx.handler.HealthCheckHandler';
        }

            error_page   500 502 503 504  /50x.html;
            location = /50x.html {
            }

            error_page  404  /404.html;
        location = /404.html {
        }
    }
</pre></p></div></div><div class="sectiondiv"><b>Configuring Nginx from Platform</b><p>You can configure the Nginx server
					in the following ways in Platform:<ul><li>Configuring Nginx from the <span class="uicontrol">System Console &gt; System &gt; Servers
								&gt; NGINX Server</span></li><li>Configuring Nginx through the node-config.json file</li><li>Using REST API</li></ul></p></div><p>To configure the <span class="filepath">nginx.conf</span> file,
				do the following:</p></p>
                                            <ol class="steps">
                                                <li class="step" value="1"><span class="cmd">user: Set to <span class="filepath">root</span> so that java plug-in module can get
					admin permission to the nginx installed location.</span>
                                                </li>
                                                <li class="step" value="2"><span class="cmd">worker_processes: Set to <code>auto</code>. Nginx will automatically create
					the worker processes based on the machine configuration. In general, count of
					workers depends on the number of cores.</span>
                                                </li>
                                                <li class="step" value="3"><span class="cmd">Java handler listens on different port (default is 9080). </span>
                                                </li>
                                                <li class="step" value="4"><span class="cmd">jvm_path: Used by java handler to initialize the jvm.</span>
                                                </li>
                                                <li class="step" value="5"><span class="cmd">jvm_classpath: Class path for the java handler.</span>
                                                    <div class="info">shared_map: Shared memory between the workers, used by the java handler. This
					is applicable only for Linux platforms.</div>
                                                </li>
                                                <li class="step" value="6"><span class="cmd">content_handler_type: Set to java</span>
                                                </li>
                                                <li class="step" value="7"><span class="cmd">content_handler_name: Entry point for the java handler.</span>
                                                </li>
                                                <li class="step" value="8"><span class="cmd">HTTPS configuration: Nginx access can be made secure with ssl configuration.
					You can add SSL at server context, as illustrated in the example below. </span>
                                                </li>
                                                <li class="step" value="9"><span class="cmd">https upstreams: Set content_handler_property <code>is.secure.server</code>
					to 'true' for location <span class="filepath">/config/topology</span> .</span>
                                                </li>
                                            </ol>
                                            <div class="example">Adding the SSL at server
			context.<pre xml:space="preserve">#
# HTTPS HANDLER
#
 server {
        listen       9443 ssl;
        server_name  prgs.example.com;
        handlers_lazy_init on;
        root html;
				
        ssl_certificate      cert.pem;
        ssl_certificate_key  cert.key;
        ssl_session_cache    shared:SSL:1m;
        ssl_session_timeout  5m;
        ssl_ciphers  HIGH:!aNULL:!MD5;
        ssl_prefer_server_ciphers  on;   
   
        location / {
            root   html;
            index  index.html index.htm;
       }
location /config/topology {
content_handler_type 'java';
content_handler_name 'com.rb.nginx.handler.ConfigHandler';
# Set this flag to true for proxy SSL
content_handler_property is.secure.server 'true';
# Authentication handler
access_handler_type 'java';
access_handler_name 'com.rb.nginx.handler.AuthenticationHandler';
}
location /config/environment {
content_handler_type 'java';
content_handler_name 'com.rb.nginx.handler.ConfigHandler';
# Authentication handler
access_handler_type 'java';
access_handler_name 'com.rb.nginx.handler.AuthenticationHandler';
}
location /config/files {
content_handler_type 'java';
content_handler_name 'com.rb.nginx.handler.ConfigHandler';
# Authentication handler
access_handler_type 'java';
access_handler_name 'com.rb.nginx.handler.AuthenticationHandler';
}
 }</pre></div>
                                            <div class="postreq">Optionally, add any post requirements, using &lt;postreq&gt;.</div>
                                        </div>
                                    </div>
                                    <div class="panel">
                                        <div class="right-align"><a class="footer1" href="https://www.linkedin.com/company/infiniteblue/" target="_blank"><img src="https://img.icons8.com/ios-filled/25/0572ed/linkedin-2--v1.png" alt="Linkedin" /></a><a class="footer1" href="https://twitter.com/InfiniteBlueHQ" target="_blank"><img src="https://img.icons8.com/ios-filled/25/0572ed/twitter.png" alt="Twitter" /></a><a class="footer1last" href="https://www.youtube.com/channel/UCRa_FE0f3k9KJrNJyAT39Hg/featured" target="_blank"><img src="https://img.icons8.com/ios-glyphs/25/0572ed/youtube-play.png" alt="YouTube" /></a>
                                        </div>
                                        <div class="right-align-2"><a class="footer2" href="https://www.infiniteblue.com" target="_blank">Copyright Â© 2023 Infinite Blue. All Rights Reserved.</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>